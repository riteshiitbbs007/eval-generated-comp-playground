<template>
  <div class="slds-p-around_medium" style="max-width: 1600px; margin: 0 auto;">
    <div class="slds-page-header">
      <div class="slds-page-header__row">
        <div class="slds-page-header__col-title">
          <div class="slds-media">
            <div class="slds-media__body">
              <h1 class="slds-page-header__title slds-m-right_small">
                Generated Components Gallery
              </h1>
              <p class="slds-text-body_small slds-text-color_weak">
                Total components: {componentCount}
              </p>
            </div>
          </div>
        </div>
        <div class="slds-page-header__col-actions">
          <div class="slds-form-element">
            <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_left">
              <svg class="slds-icon slds-input__icon slds-input__icon_left slds-icon-text-default" aria-hidden="true">
                <use xlink:href="/public/slds/icons/utility-sprite/svg/symbols.svg#search"></use>
              </svg>
              <input
                type="text"
                class="slds-input"
                placeholder="Search components..."
                value={searchTerm}
                oninput={handleSearch}
              />
            </div>
          </div>
        </div>
      </div>
    </div>

    <template if:true={loading}>
      <div class="slds-align_absolute-center slds-m-top_xx-large">
        <lightning-spinner alternative-text="Loading components..." size="large"></lightning-spinner>
      </div>
    </template>

    <template if:true={error}>
      <div class="slds-notify slds-notify_alert slds-theme_error slds-m-top_medium">
        <span class="slds-icon_container slds-icon-utility-error">
          <svg class="slds-icon slds-icon_x-small" aria-hidden="true">
            <use xlink:href="/public/slds/icons/utility-sprite/svg/symbols.svg#error"></use>
          </svg>
        </span>
        <h2>{error}</h2>
      </div>
    </template>

    <template if:true={hasComponents}>
      <div class="gallery-accordion slds-m-top_medium">
        <template for:each={groupedComponents} for:item="group">
          <div key={group.id} class="date-group slds-m-bottom_medium">
            <!-- Date Group Header -->
            <button
              class="date-group-header slds-button slds-button_reset"
              onclick={handleToggleSection}
              data-section-id={group.id}
            >
              <svg class="slds-icon slds-icon_small slds-m-right_x-small" aria-hidden="true">
                <template if:true={group.isOpen}>
                  <use xlink:href="/public/slds/icons/utility-sprite/svg/symbols.svg#chevrondown"></use>
                </template>
                <template if:false={group.isOpen}>
                  <use xlink:href="/public/slds/icons/utility-sprite/svg/symbols.svg#chevronright"></use>
                </template>
              </svg>
              <span class="date-group-title">{group.label}</span>
              <span class="date-group-count">({group.countLabel})</span>
            </button>

            <!-- Date Group Content -->
            <template if:true={group.isOpen}>
              <div class="gallery-grid slds-m-top_small">
                <template for:each={group.components} for:item="component">
                  <article key={component.componentName} class="slds-card component-card">
                    <!-- Component info -->
                    <div class="slds-card__body slds-card__body_inner slds-p-around_small">
                      <div class="component-header slds-m-bottom_xx-small">
                        <h2 class="slds-text-heading_small slds-truncate" title={component.componentName}>
                          {component.componentName}
                        </h2>
                        <template if:true={component.hasNotes}>
                          <span class="note-badge" title={component.notesTooltip}>
                            <svg class="slds-icon slds-icon_xx-small" aria-hidden="true">
                              <use xlink:href="/public/slds/icons/utility-sprite/svg/symbols.svg#note"></use>
                            </svg>
                            {component.noteCount}
                          </span>
                        </template>
                      </div>

                      <div class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                        {component.tier} • {component.complexity} • {component.formattedDate}
                      </div>

                      <!-- Screenshot -->
                      <template if:true={component.screenshotUrls.desktop}>
                        <div class="screenshot-container slds-m-bottom_small">
                          <img
                            src={component.screenshotUrls.desktop}
                            alt={component.componentName}
                            class="screenshot-preview"
                            onclick={handleComponentSelect}
                            data-name={component.componentName}
                          >
                        </div>
                      </template>

                      <!-- Scores -->
                      <div class="score-section slds-m-bottom_x-small">
                        <span class="score-overall">
                          Overall: {component.formattedScore}
                        </span>
                        <span class="score-slds slds-text-color_weak">
                          SLDS: {component.formattedSldsScore}
                        </span>
                      </div>

                      <!-- Violations -->
                      <div class="slds-text-body_small slds-text-color_weak slds-m-bottom_small">
                        Violations: {component.violations.warnings}W {component.violations.errors}E
                      </div>
                    </div>

                    <footer class="slds-card__footer">
                      <button
                        class="slds-button slds-button_brand slds-button_stretch"
                        onclick={handleComponentSelect}
                        data-name={component.componentName}
                      >
                        View Details
                      </button>
                    </footer>
                  </article>
                </template>
              </div>
            </template>
          </div>
        </template>
      </div>
    </template>

    <template if:false={hasComponents}>
      <template if:false={loading}>
        <div class="slds-align_absolute-center slds-m-top_xx-large">
          <div class="slds-text-align_center">
            <svg class="slds-icon slds-icon_large slds-icon-text-default" aria-hidden="true">
              <use xlink:href="/public/slds/icons/utility-sprite/svg/symbols.svg#knowledge_base"></use>
            </svg>
            <h2 class="slds-text-heading_medium slds-m-top_medium">
              No components generated yet
            </h2>
            <p class="slds-text-body_regular slds-m-top_small">
              Run the eval tests to generate components
            </p>
          </div>
        </div>
      </template>
    </template>
  </div>
</template>
